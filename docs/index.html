<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ImageStack-SVG Demo</title>
    <link rel="icon" href="./favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.css"></link>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/codemirror.min.js"></script>
    <script type="text/javascript" src="liquid.browser.min.js"></script>
    <style>
      html, body, main {
        width: 100%;
        height: 100%;
      }

      .CodeMirror {
        resize: vertical;
      }
    </style>
  </head>

  <body>
    <main class="d-flex flex-column">
      <section class="mb-2 border border-secondary border-3">
        <textarea id="inputCode"></textarea>
      </section>
      <section class="mb-2 border border-secondary border-3">
        <textarea id="jsonInput"></textarea>
      </section>
      <section class="mflex-grow-1">
        <svg class="w-100 h-100" id="outputSvg"></svg>
      </section>
    </main>
    <script type="text/javascript">
      var engine = new liquidjs.Liquid();

      engine.registerFilter('web_image', v => v);
      engine.registerFilter('emoji', v => "https://emojiapi.dev/api/v1/" + (v.codePointAt(0).toString(16)) + '.svg');

      var jsonInput = CodeMirror.fromTextArea(document.getElementById('jsonInput'), {
        lineNumbers: true
      });
      jsonInput.setSize("100%", "100px");
      jsonInput.setValue(`{"name": "Peter", "color": [255, 0, 0], "member": "ðŸŽ¨", "lvl": 42}`);
      var outputSvg = document.getElementById('outputSvg');
      var inputCode = CodeMirror.fromTextArea(document.getElementById('inputCode'), {
        lineNumbers: true
      });

      function onChange(cm, change) {
        try {
          outputSvg.innerHTML = engine.parseAndRenderSync(inputCode.getValue(), JSON.parse(jsonInput.getValue()));
        } catch(error) {
          console.log(error.message);
        }
      }


      inputCode.on("change", onChange);
      jsonInput.on("change", onChange);
      inputCode.setValue(`<defs>
<linearGradient id="color1">
	<stop offset="0%" stop-color="rgb({{ color[0] }}, {{ color[1] }}, {{ color[2] }})" />
	<stop offset="100%" stop-color="rgb({{ color[0] }}, {{ color[1] }}, {{ color[2] }})" />
</linearGradient>
<linearGradient id="color2">
	<stop offset="0%" stop-color="rgb({{ color[0] }}, {{ color[1] }}, {{ color[2] }})" stop-opacity="0" />
	<stop offset="100%" stop-color="rgb({{ color[0] }}, {{ color[1] }}, {{ color[2] }})" />
</linearGradient>
</defs>
<rect x="0" y="0" width="200" height="100" rx="20" ry="20" fill="rgb(48, 50, 55)" />
<rect x="1" y="1" width="198" height="98" rx="20" ry="20" stroke-width="3" fill="none" stroke="url(#color1)" />
<text x="102" y="30" text-anchor="middle" font-family="Calibri" font-weight="bold" font-size="22" fill="url(#color1)">LEVELUP</text>
<image x="58" y="70" width="16" height="16" xlink:href="{{ member | emoji }}"/>
<image x="125" y="70" width="16" height="16" xlink:href="{{ member | emoji }}"/>
<rect x="82" y="77" width="34" height="4" rx="2" ry="2" fill="url(#color2)" />
<text x="53" y="82" text-anchor="end" font-family="Calibri" font-size="12" fill="rgb({{ color[0] }}, {{ color[1] }}, {{ color[2] }})">Lvl. {{lvl}}</text>
<text x="145" y="82" font-family="Calibri" font-size="12" fill="rgb({{ color[0] }}, {{ color[1] }}, {{ color[2] }})">Lvl. {{lvl}}</text>
<text x="100" y="55" text-anchor="middle" font-family="Calibri" font-size="13" fill="rgb(255, 255, 255)">{{name}}</text>`);      
      
    </script>
  </body>
</html>
